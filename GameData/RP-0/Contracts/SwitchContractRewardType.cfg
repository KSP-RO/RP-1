// Make sure all contracts have all fields
@CONTRACT_TYPE:HAS[~genericAdvanceMultiplier&#genericAdvance]:AFTER[00_ContractSetup]
{
	genericAdvanceMultiplier = 0.0 // If genericAdvance is provided, default genericAdvanceMultiplier to 0
}
@CONTRACT_TYPE:HAS[~genericAdvanceMultiplier]:AFTER[00_ContractSetup]
{
	genericAdvanceMultiplier = 2.0/3.0 // This is the default setup if neither genericAdvance nor genericAdvanceMultiplier are provided
}
@CONTRACT_TYPE:HAS[~genericFailureMultiplier]:AFTER[00_ContractSetup]
{
	genericFailureMultiplier = 1.5
}
@CONTRACT_TYPE:HAS[~genericReward]:AFTER[00_ContractSetup]
{
	genericReward = 0
}
@CONTRACT_TYPE:HAS[~genericAdvance]:AFTER[00_ContractSetup]
{
	genericAdvance = 0
}
@CONTRACT_TYPE:HAS[~genericBonus]:AFTER[00_ContractSetup]
{
	genericBonus = 0
}

// Normal rewards
@CONTRACT_TYPE:AFTER[00_ContractSetup] 
{
	%advanceFunds = @genericReward * @genericAdvanceMultiplier + @genericAdvance
	%rewardFunds = @genericReward * (1 - @genericAdvanceMultiplier) + @genericBonus
	%rewardReputation = Pow(@rewardFunds/1000, 0.5)
	%failureFunds = Max(0, @advanceFunds * (@genericFailureMultiplier - 1))
	%failureReputation = Max(0, @rewardReputation * @genericFailureMultiplier)
}

// Reputation rewards
@CONTRACT_TYPE:AFTER[00_ContractSetup]:NEEDS[RP1DoUseBudgets]
{
	@advanceFunds = @genericReward * @genericAdvanceMultiplier*0.15 + @genericAdvance
	@rewardFunds = 0
	@rewardReputation = (@genericReward * (1.1 - @genericAdvanceMultiplier*0.15) + @genericBonus) / 1000
	@failureFunds = 0
	@failureReputation = Max(0, @advanceFunds * (@genericFailureMultiplier - 1) / 1000)
}

// Convert it to CC speak...
@CONTRACT_TYPE:AFTER[00_ContractSetup]
{
	DATA {
		type = float
		name = ContractSetupRewardData
		
		genericReward = #$../genericReward$
		genericAdvance = #$../genericAdvance$
		genericBonus = #$../genericBonus$
		genericAdvanceMultiplier = #$../genericAdvanceMultiplier$
		genericFailureMultiplier = #$../genericFailureMultiplier$
	}
}

// Remove the unneeded values
@CONTRACT_TYPE:AFTER[00_ContractSetup]
{
	-genericReward,0=remove
	-genericAdvance,0=remove
	-genericBonus,0=remove
	-genericAdvanceMultiplier,0=remove
	-genericFailureMultiplier,0=remove
}